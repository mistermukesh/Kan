<!DOCTYPE html>
<html lang="en">
<head>
  <!-- [Previous head content remains the same] -->
  <style>
    /* [Previous styles remain the same] */
    
    .error-message {
      color: #d32f2f;
      background-color: #ffebee;
      padding: 15px;
      border-radius: 6px;
      border-left: 4px solid #d32f2f;
      margin: 15px 0;
    }
    
    .retry-button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <!-- [Previous HTML content remains the same until the script section] -->

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('currentYear').textContent = new Date().getFullYear();
      loadComplaintData();
    });

    function loadComplaintData() {
      const urlParams = new URLSearchParams(window.location.search);
      const trackingId = urlParams.get('id');
      
      if (!trackingId) {
        showError('Error: No tracking ID provided in URL');
        return;
      }

      // Clear previous content while loading
      document.getElementById('statusMessage').innerHTML = '<div class="loading">Loading complaint status...</div>';
      document.getElementById('complaintDetails').innerHTML = '<div class="loading">Loading complaint details...</div>';

      // Add timestamp to prevent caching
      const timestamp = new Date().getTime();
      const scriptUrl = `https://script.google.com/macros/s/AKfycbxOPxiXlD0eixcG1IEX5g84MLKdylDg8W13Lg4WWnW548_htYglSpPEkyw8n2G0OEs4/exec?id=${trackingId}&_=${timestamp}`;
      
      fetch(scriptUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          if (data.error) {
            showError(data.message);
          } else {
            displayComplaintData(data);
          }
        })
        .catch(error => {
          console.error('Fetch error:', error);
          showError('Failed to load complaint data. Please try again later.', true);
        });
    }

    function displayComplaintData(data) {
      try {
        // Display reference number
        const refNoElement = document.getElementById('refNo');
        refNoElement.textContent = data.refNo || 'N/A';

        // Display status message
        const statusMessage = document.getElementById('statusMessage');
        statusMessage.innerHTML = '';

        if (data.statusMessage) {
          const messageDiv = document.createElement('div');
          messageDiv.className = 'status-message';
          messageDiv.textContent = data.statusMessage;
          statusMessage.appendChild(messageDiv);
        }

        // Display complaint details
        const detailsContainer = document.getElementById('complaintDetails');
        detailsContainer.innerHTML = '';

        if (data.details && Object.keys(data.details).length > 0) {
          for (const [label, value] of Object.entries(data.details)) {
            const detailItem = document.createElement('div');
            detailItem.className = 'details-item';

            const detailLabel = document.createElement('div');
            detailLabel.className = 'detail-label';
            detailLabel.textContent = label;

            const detailValue = document.createElement('div');
            detailValue.className = 'detail-value';
            detailValue.textContent = value || 'Not specified';

            detailItem.appendChild(detailLabel);
            detailItem.appendChild(detailValue);
            detailsContainer.appendChild(detailItem);
          }
        } else {
          detailsContainer.innerHTML = '<div>No additional details available</div>';
        }
      } catch (error) {
        console.error('Display error:', error);
        showError('Error displaying complaint data');
      }
    }

    function showError(message, showRetry = false) {
      const statusMessage = document.getElementById('statusMessage');
      statusMessage.innerHTML = `
        <div class="error-message">
          ${message}
          ${showRetry ? '<button class="retry-button" onclick="loadComplaintData()">Try Again</button>' : ''}
        </div>
      `;
      
      document.getElementById('complaintDetails').innerHTML = '';
    }
  </script>
</body>
</html>
